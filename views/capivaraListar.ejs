<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<link href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" rel="stylesheet" />
<link href="stylesheets/chat.css" rel="stylesheet" />

<% if(mensagemSucesso) { %>
<p class="font-semibold text-center text-green-600 bg-green-200 p-2 rounded">
  <%= mensagemSucesso %>
</p>
<% } %>

<div class="grid-cols-1 sm:grid md:grid-cols-4">
  <% for (let i = 0; i < capivaras.length; i++) { %>
  <div class="mx-3 mt-6 flex flex-col rounded-lg bg-white shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] dark:bg-neutral-700 sm:shrink-0 sm:grow sm:basis-0">
    <% if(capivaras[i].imagem){%>
    <img class="rounded-t-lg" src="/imagens/capivara/<%= capivaras[i].imagem %>" alt="Capivara" />
    <% }else{%>
    <img class="rounded-t-lg" src="/imagens/capivaraDefault.png" alt="Capivara" />
    <%}%>
    <div class="p-6">
      <h5
        class="mb-2 text-xl font-medium leading-tight text-neutral-800 dark:text-neutral-50"
      >
        <%= capivaras[i].nome %>
    </h5>
    <p class="mb-4 text-base text-neutral-600 dark:text-neutral-200">
      <span>Idade: <%= capivaras[i].idade %></span><br />
      <span>Descrição: <%= capivaras[i].descricao %></span>
    </p>
  </div>
  <div class="mt-auto border-t-2 border-neutral-100 px-6 py-3 text-center dark:border-neutral-600 dark:text-neutral-50">
    <span>Responsável: <% if (capivaras[i].usuarioId !== null) { %> <%=
        capivaras[i]['usuario.nome'] %> <% } else { %> Nenhum <% } %>
    </span>
  </div>
  <div class="mt-auto border-t-2 border-neutral-100 px-6 py-3 text-center dark:border-neutral-600 dark:text-neutral-50">
    <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">
      Comentários
    </button>

    <div id="comentarios" class="">
      <div class="mt-2 space-x-2 border-neutral-800 border-2 bg-neutral-600">
        <div class="ps-container ps-theme-default ps-active-y" id="chat-conteudo" style="overflow-y: scroll !important; height: 400px !important"></div>

        <form action="javascript:enviaMensagens()">
          <div class="publisher bt-1 border-light">
            <input class="publisher-input bg-neutral-400" type="text" placeholder="" id="mensagem" />

            <button type="submit">
              <i class="fa fa-paper-plane"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="mt-auto border-t-2 border-neutral-100 px-6 py-3 text-center dark:border-neutral-600 dark:text-neutral-50">
    <div class="mt-2 space-x-2">
      <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
        Editar
      </button>
      <% if(capivaras[i].usuarioId == locals.id || !capivaras[i].usuarioId){
        %>

      <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">
        Deletar
      </button>
      <% } %>
    </div>
  </div>
</div>
<% } %>

<script type="text/javascript" src="/javascript/chat.js"></script>
<script type="text/javascript" language="javascript">
  buscaMensagens();
  //dispara a função para já buscar os dados quando carregar a página
  //Executa novamente a função a cada 5000 milissegundos (5 segundos)
  setInterval("buscaMensagens()", 5000);
</script>
</div>